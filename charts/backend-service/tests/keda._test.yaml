# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test Keda
templates:
  - keda.yaml
release:
  name: ecj
tests:
  - it: When unsetting overlaid triggers, triggers get nulled
    values:
      - ../ci/keda-values.yaml
    capabilities:
      apiVersions:
        - keda.sh/v1alpha1
    template: keda.yaml
    set:
      keda:
        enabled: true
        triggers:
          rabbitmq-trigger: null
          cron-trigger: null
    asserts:
      - isKind:
          of: ScaledObject
      - equal:
          path: spec.triggers
          value: [null, null]

  - it: When nulling triggers, render fails
    values:
      - ../ci/keda-values.yaml
    capabilities:
      apiVersions:
        - keda.sh/v1alpha1
    template: keda.yaml
    set:
      keda:
        enabled: true
        triggers: null
    asserts:
      - failedTemplate:
          errorPattern: "at least one trigger"
