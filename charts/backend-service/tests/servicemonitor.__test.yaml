# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Regression Test Servicemonitor
templates:
  - servicemonitor.yaml
release:
  name: ut
tests:
  - it: When given port for metrics
    set:
      image.tag: pinned-version
      ports.metrics: 9003
      prometheus.enabled: true
      prometheus.serviceMonitor.enabled: true
    capabilities:
      apiVersions:
        - monitoring.coreos.com/v1
    template: servicemonitor.yaml
    asserts:
      - equal:
          path: spec.endpoints[0].port
          value: metrics

  - it: When not given port for metrics
    set:
      image.tag: pinned-version
      prometheus.enabled: true
      prometheus.serviceMonitor.enabled: true
    capabilities:
      apiVersions:
        - monitoring.coreos.com/v1
    template: servicemonitor.yaml
    asserts:
      - equal:
          path: spec.endpoints[0].port
          value: http
